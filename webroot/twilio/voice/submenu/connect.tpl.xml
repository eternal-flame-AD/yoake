{{ template "/twilio/head.tpl.xml" . }}
{{ $session := (get .Global "twilio_session") }}
{{ $toNumber := "+15122993080" }}
{{ $fromNumber := get .Global "from" }}

{{ $callerId := $fromNumber }}
{{ if $v := (invoke "QueryParam" .C "connect_to") }}
    {{ $toNumber = $v }}
{{ end }}

{{ $record_reason := (invoke "QueryParam" .C "record_reason") }}
{{ $record := (invoke "QueryParam" .C "record") }}

<Response>
{{ if $record_reason }}
    <Say voice="alice" language="en-US">This call may be recorded for {{ $record_reason | xml }}.</Say>
{{ end }}
    <Dial
        action="/twilio/voice/submenu/connect-finish.xml"
        callerId="{{ $callerId | xml }}"
{{ if or $record $record_reason }}
        record="record-from-answer-dual"
        recordingStatusCallback="/api/twilio/callback/recording/connect"
        recordingStatusCallbackMethod="POST"
{{ end }}
        >
        <Number
        >{{ $toNumber | xml }}</Number>
    </Dial>
</Response>